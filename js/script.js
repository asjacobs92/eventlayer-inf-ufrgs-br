/*var eventList =
[
	{
		"EventId":1,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":2,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":3,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":4,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":5,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":6,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":7,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":8,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":9,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":10,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":11,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":12,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":13,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":14,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	},
	{
		"EventId":15,
		"EventTitle":"Feira de Oportunidade da UFRGS",
		"EventType":"Palestra",
		"EventImage":"resource/logo.jpg",
		"TimeStart":"2014-02-05 15:25:23",
		"TimeEnd":"2014-02-28 14:29:48",
		"Description":"Feira para palestras de empresas interessadas na carne fresca da UFRGS.",
		"Longitude":-51.121261,
		"Latitude":-30.068719
	},
	{
		"EventId":16,
		"EventTitle":"Workshop de WebServices",
		"EventType":"Workshop",
		"EventImage":"resource/logo2.jpg",
		"TimeStart":"2014-02-05 00:00:00",
		"TimeEnd":"2014-02-17 00:00:00",
		"Description":"Workshop sobre diferentes tipos de WebServices.",
		"Longitude":-51.120520,
		"Latitude":-30.068685
	}
];*/

var eventList;

var map;
var markers = [];

var page = "php/consulta.php";

function initialize() {
	initializeMap();
	$.getJSON(page, initializeEvents);

}

function initializeMap() {
	var mapCanvas = document.getElementById("events-map");
	var mapOptions = {
			center: new google.maps.LatLng(-30.068473, -51.120434),
			zoom: 18,
			mapTypeId: google.maps.MapTypeId.ROADMAP,
			mapTypeControl: false
		}
	map = new google.maps.Map(mapCanvas, mapOptions)
}

function initializeEvents(eventList) {
	
	var infowindow = new google.maps.InfoWindow(), marker, i;
	for (i = 0; i < eventList.length; i++) {
		var start = eventList[i].timeStart.split(" ");
		var startDate = start[0];
		var startTime = start[1];

		var end = eventList[i].timeEnd.split(" ");
		var endDate = end[0];
		var endTime = end[1];

		var eventInfo =
			"<form action='index.php' method='post'>" +
				"<input type='text' value='" + eventList[i].eventId +"' hidden name='eventId'/>" +
				"<div class='event-card-wide mdl-card mdl-shadow--2dp mdl-js-ripple-effect'>" + 
			      	"<div class='mdl-card__title' style='background: url("+ eventList[i].image +") left top / cover'>" + 
			      		"<h2 class='mdl-card__title-text'>" + eventList[i].title + "</h2>" + 
			      	"</div>" +
			      	"<div class='mdl-card__supporting-text'>" + 
			      		"<table id='eventPopup'>" +
				      		"<tr>" +
								"<td class='inp' colspan='0'>Início em </td>" +
								"<td class='inp' colspan='2'> <strong>" + startDate + "</strong> às <strong>"+ startTime + "</strong> </td>" +
								"<td class='inp' colspan='3'>" + eventList[i].type + "</td>" +
							"</tr>" +
							"<tr>" +
								"<td class='inp' colspan='0'> até </td><td class='inp' colspan='2' style='text-align:center;'> <strong>" + endDate + "</strong> às <strong>" + endTime + "</strong></td>" +
							"</tr>" +
						"</table>" +
						eventList[i].description + eventList[i].placeName +
			      	"</div>" +
			    "</div>" +
		    "</form>";
		$('#events-list').append(("<div class='mdl-cell mdl-cell--1-col clickable justified'> " + eventInfo + "</div>"));	//events on list

		marker = new google.maps.Marker({
			position: new google.maps.LatLng(eventList[i].latitude, eventList[i].longitude),
			map: map,
			title: eventList[i].title
		});

		google.maps.event.addListener(marker, 'mouseover', (function(marker, eventInfo) {		//markers on map
			return function() {
					infowindow.setContent(eventInfo);
					infowindow.open(map, marker);
			}
		}) (marker, eventInfo));

		google.maps.event.addListener(marker, 'mouseout', (function(marker, eventInfo) {		//markers on map
			return function() {
					infowindow.close();
			}
		}) (marker, eventInfo));

		google.maps.event.addListener(infowindow, 'domready', function() {
		    // Reference to the DIV that wraps the bottom of infowindow
		    var infoWindowOuter = $('.gm-style-iw');
		    var infoWindowBackground = infoWindowOuter.prev();
		    // Removes background shadow DIV
		    infoWindowBackground.children(':nth-child(2)').css({'display' : 'none'});
		    // Removes white background DIV
		    infoWindowBackground.children(':nth-child(4)').css({'display' : 'none'});

		    infoWindowBackground.children(':nth-child(3)').find('div').children().css({'box-shadow': 'rgba(178, 178, 178, 0.6) 0px 1px 6px', 'z-index' : '1'});

		    // Reference to the div that groups the close button elements.
		    var infoWindowCloseBtn = infoWindowOuter.next();
		    // Apply the desired effect to the close button
		    infoWindowCloseBtn.css({display: 'none'});
		  });

		markers.push(marker);
	}
}

function toggleList() {
	$('#events-list').slideToggle();
}
function consulta() {
	var and = 0;
	page = "php/consulta.php";
	if ($("#txt").val().length > 0){
		var value = $("#txt").val();
		page = page + "?txt=" + value;
		and = 1;
	}

	if ($("#ts").val().length > 0){
		if(and){
			var value = $("#ts").val();
			page = page + "&ts=" + value;
		}
		else{
			var value = $("#ts").val();
			page = page + "?ts=" + value;
			and = 1;
		}
	}

	if ($("#te").val().length > 0){
		if(and){
			var value = $("#te").val();
			page = page + "&te=" + value;
		}
		else{
			var value = $("#te").val();
			page = page + "?te=" + value;
			and = 1;
		}
	}

	//alert(page);
	
	$('#events-list').empty();

	eventList = null;
	deleteMarkers();
	//map = null;
	$.getJSON(page, initializeEvents);
	//initialize();
}

function deleteMarkers() {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(null);
  }
  markers = [];
}

function clearMarkers() {
  setMapOnAll(null);
}

function setMapOnAll(map) {
  for (var i = 0; i < markers.length; i++) {
    markers[i].setMap(map);
  }
}


